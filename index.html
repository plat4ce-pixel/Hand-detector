<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Hand Detector - Febri Edition</title>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils"></script>
    <style>
        body { font-family: 'Arial', sans-serif; text-align: center; background: #0f0f0f; color: white; margin: 0; padding: 20px; }
        .container { position: relative; display: inline-block; border: 4px solid #00ffcc; border-radius: 20px; overflow: hidden; box-shadow: 0 0 20px rgba(0,255,204,0.3); }
        #output_canvas { position: absolute; left: 0; top: 0; transform: scaleX(-1); }
        #input_video { transform: scaleX(-1); }
        #status { font-size: 2.5rem; font-weight: bold; margin-top: 20px; min-height: 60px; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); }
        .hallo { color: #4CAF50; }
        .love { color: #FF4081; }
        .qisthy { color: #00E5FF; }
        .toxic { color: #f44336; animation: shake 0.2s infinite; }
        @keyframes shake { 0% { transform: translateX(0); } 25% { transform: translateX(5px); } 50% { transform: translateX(-5px); } 100% { transform: translateX(0); } }
    </style>
</head>
<body>

    <h2>AI Hand Gesture - Febri Edition</h2>
    
    <div class="container">
        <video id="input_video" width="640px" height="480px" style="display:none;"></video>
        <canvas id="output_canvas" width="640px" height="480px"></canvas>
    </div>

    <div id="status">Menunggu Tangan...</div>

    <script>
        const videoElement = document.getElementById('input_video');
        const canvasElement = document.getElementById('output_canvas');
        const canvasCtx = canvasElement.getContext('2d');
        const statusDiv = document.getElementById('status');

        let lastText = "";

        function speak(text) {
            if (lastText !== text) {
                window.speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'id-ID';
                window.speechSynthesis.speak(utterance);
                lastText = text;
            }
        }

        function onResults(results) {
            canvasCtx.save();
            canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);
            canvasCtx.drawImage(results.image, 0, 0, canvasElement.width, canvasElement.height);

            if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
                if (results.multiHandLandmarks.length === 2) {
                    statusDiv.innerText = "ü´∂ Suka";
                    statusDiv.className = "love";
                    speak("Suka");
                } else {
                    for (const landmarks of results.multiHandLandmarks) {
                        detectOneHandGesture(landmarks);
                    }
                }

                for (const landmarks of results.multiHandLandmarks) {
                    drawConnectors(canvasCtx, landmarks, HAND_CONNECTIONS, {color: '#00FFCC', lineWidth: 4});
                    drawLandmarks(canvasCtx, landmarks, {color: '#FF0000', lineWidth: 1, radius: 3});
                }
            } else {
                statusDiv.innerText = "Mana tangannya?";
                statusDiv.className = "";
                lastText = ""; 
            }
            canvasCtx.restore();
        }

        function detectOneHandGesture(lm) {
            const thumbUp = lm[4].y < lm[3].y;
            const indexUp = lm[8].y < lm[6].y;
            const middleUp = lm[12].y < lm[10].y;
            const ringUp = lm[16].y < lm[14].y;
            const pinkyUp = lm[20].y < lm[18].y;
            
            // Deteksi telapak tangan menghadap atas (ü´¥ Qisthy)
            // Sederhananya: pergelangan tangan (0) lebih rendah dari telapak tengah (9)
            const palmUp = lm[0].y > lm[9].y && lm[4].x < lm[20].x;

            const distThumbIndex = Math.sqrt(Math.pow(lm[4].x - lm[8].x, 2) + Math.pow(lm[4].y - lm[8].y, 2));

            // 1. üñï Tidak Sopan
            if (middleUp && !indexUp && !ringUp && !pinkyUp) {
                statusDiv.innerText = "üñï Tidak Sopan";
                statusDiv.className = "toxic";
                speak("Tidak sopan");
                setTimeout(() => { window.location.href = "about:blank"; }, 2000); 
            }
            // 2. ü´¥ Qisthy (Tangan terbuka menghadap ke atas/seperti meminta)
            else if (thumbUp && indexUp && middleUp && ringUp && pinkyUp && lm[12].y > lm[10].y * 0.8) {
                 // Logika disesuaikan untuk posisi tangan "cup"
                 statusDiv.innerText = "ü´¥ Qisthy";
                 statusDiv.className = "qisthy";
                 speak("Qisthy");
            }
            // 3. üôè Terima Kasih (Menggantikan Izin Izin)
            else if (indexUp && middleUp && ringUp && pinkyUp && !thumbUp) {
                statusDiv.innerText = "üôè Terima Kasih";
                statusDiv.className = "hallo";
                speak("Terima kasih");
            }
            // 4. üñê Hallo
            else if (indexUp && middleUp && ringUp && pinkyUp && thumbUp) {
                statusDiv.innerText = "üñê Hallo";
                statusDiv.className = "hallo";
                speak("Halo");
            }
            // 5. üëå Ok
            else if (distThumbIndex < 0.05 && middleUp && ringUp && pinkyUp) {
                statusDiv.innerText = "üëå Ok";
                statusDiv.className = "hallo";
                speak("Oke");
            }
            // 6. ‚úåÔ∏è Namaku
            else if (indexUp && middleUp && !ringUp && !pinkyUp) {
                statusDiv.innerText = "‚úåÔ∏è Namaku";
                statusDiv.className = "love";
                speak("Namaku");
            }
            // 7. ‚òùÔ∏è Febri
            else if (indexUp && !middleUp && !ringUp && !pinkyUp) {
                statusDiv.innerText = "‚òùÔ∏è Febri";
                statusDiv.className = "love";
                speak("Febri");
            }
            // 8. ü´∞ I Love You
            else if (thumbUp && indexUp && !middleUp && !ringUp && !pinkyUp) {
                statusDiv.innerText = "ü´∞ I Love You";
                speak("I love you");
            }
        }

        const hands = new Hands({locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`});
        hands.setOptions({ maxNumHands: 2, modelComplexity: 1, minDetectionConfidence: 0.7, minTrackingConfidence: 0.7 });
        hands.onResults(onResults);

        const camera = new Camera(videoElement, {
            onFrame: async () => { await hands.send({image: videoElement}); },
            width: 640, height: 480
        });
        camera.start();
    </script>
</body>
</html>
